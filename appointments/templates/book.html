{% extends "base.html" %}
{ % load base.css % }
{% block content %}
{% load bag_tools %}
{ % load service % }
{% block inner_content %}
<div class='container-fluid' align="center">
    <div class="row">
        <div class="col-sm-12">
            <a class="navbar" href="{% url 'home' %}">
                <img src="{ % static 'media/art3.jpg' % }" alt="logo" style="width:120px;">
                <h1>
                    <font face="Courier New" size=6 color="black">
                        <h1>The Conxia Lounge Salon</h1>
                    </font>
                </h1>

            </a>
        </div>
    </div>

</div>
<div class="container header-container">
    <div class="overlay"></div>
    <div class="row">

        <hr>

        <div class="col-12 col-md-6">
            <div class="allauth-form-inner-content">
                <div id="topnav" class="row bg-white pt-mf-2 d-none d-lg-flex">
                    <div class="col-12 col-lg-4 my-auto py-1 py-lg-0 text-center text-lg-left">
                        <a href="{% url 'home' %}" class="nav-link main-logo-link">
                            <h2 class="logo-font text-black my-0"><strong>Conxia</strong> Nail Parlor</h2>
                        </a>
                    </div>
                </div>

            </div>
        </div>
        </header>
        <div class="container  px-1 py-5 mx-auto">
            <div class=" row d-flex justify-content-center">
                <div class="col-12">
                    <div class="card h-100 b-0">
                        <form method="POST" action="{% url 'success' %}">{% csrf_token %}
                            <h3 class="heading">Book your Service</h3>

                            <!-- 
                            <ul id="progressbar" class="text-center">
                                <li class="active step0" id="step1"></li>
                                <li class="step0" id="step2"></li>
                                <li class="step0" id="step3"></li>
                                <li class="step0" id="step4"></li>
                            </ul> -->


                            <fieldset class="show">
                                <div class="form-card" align="center">
                                    <h5 class="sub-heading" align="left">Select Service :</h5>
                                    <hr>
                                    <button id="next0" class="btn btn-primary mt-1 mb-1 next mt-4"
                                        onclick="validate1(0)">Book in for a service :</h5>
                                        <div class="col-12">
                                            <div class="col-3"></div>
                                            <li>Manicure</li>&nbsp;
                                            <li>Pedicure</li>&nbsp;
                                            <li>Full
                                                Set</li>&nbsp;

                                        </div>
                                        <div class="form-group">
                                            <input name="service" id="service" type="text" data-provide="typeahead"
                                                class="form-control" placeholder="Type your service..." required>

                                        </div>

                            </fieldset>
                            <fieldset>
                                <div class="form-card" align="center">
                                    <h5 class="sub-heading mb-4" align="left">Select Stylist</h5>

                                    <div class="form-group">
                                        <div class="select mb-3"> <select name="employee" class="form-control" required>
                                                <option>Random</option>
                                                {% for employee in employees %}
                                                <option>{{ employee }}</option>
                                                {% endfor %}
                                            </select> </div>
                                    </div>
                                    <button id="next2" class="btn btn-primary mt-3 mb-1 next mt-4"
                                        onclick="validate1(0)">NEXT<span
                                            class="fa fa-long-arrow-right"></span></button><br>
                                    <button style="width:150px;" class="btn btn-secondary mt-3 mb-1 prev mt-4"><span
                                            class="fa fa-long-arrow-left"></span>PREVIOUS</button>
                                </div>
                            </fieldset>
                            <fieldset>
                                <div class="form-card" align="center">
                                    <h5 class="sub-heading mb-4" align="left">Personal Details
                                    </h5>
                                    <div class="form-group"> <label class="form-control-label">Full Name
                                            :</label> <input type="text" id="name" name="name" placeholder=""
                                            class="form-control" onblur="validate2(1)" required> </div>
                                    <div class="form-group"> <label class="form-control-label">Email Id
                                            :</label> <input type="text" id="cname" name="email" placeholder=""
                                            class="form-control" onblur="validate2(1)" required> </div>
                                    <div class="form-group"> <label class="form-control-label">Phone
                                            :</label> <input type="text" id="zip" name="contact" placeholder=""
                                            class="form-control" onblur="validate2(2)" required> </div>
                                    <div class="form-group"> <label class="form-control-label">Date
                                            :</label> <input type="date" id="state" name="date" placeholder=""
                                            class="form-control" onblur="validate2(3)" required> </div>
                                    <div class="form-group"> <label class="form-control-label">Time
                                            :</label>
                                        <div class="select mb-3"> <select name="time" class="form-control" required>
                                                <option>Choose visit time</option>
                                                <option>10:00 am</option>
                                                <option>11:00 am</option>
                                                <option>12:00 am</option>
                                                <option>1:00 pm</option>
                                                <option>2:00 pm</option>
                                                <option>3:00 pm</option>
                                                <option>4:00 pm</option>
                                                <option>5:00 pm</option>
                                                <option>6:00 pm</option>
                                            </select> </div>
                                    </div> <button style="width:250px;" class="btn btn-primary mt-3 mb-1 next mt-4"
                                        onclick="validate2(0)">CONFIRM BOOKING<span
                                            class="fa fa-long-arrow-right"></span></button>
                                    <br><button style="width:150px;" type="submit"
                                        class="btn-block btn-secondary mt-3 mb-1 prev"><span
                                            class="fa fa-long-arrow-left"></span>PREVIOUS</button>
                                </div>
                            </fieldset>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        { % block content % }
        <div class="overlay"></div>
        <div class="container mb-2">
            <div class="row">
                <div class="col">
                    <hr>
                    <h2 class="logo-font mb-4">Shopping Bag</h2>
                    <hr>
                </div>
            </div>

            <div class="row">
                <div class="col">
                    {% if appointment %}
                    <div class="table-responsive rounded">
                        <table class="table table-sm table-borderless">
                            <thead class="text-black">
                                <tr>
                                    <th scope="col">Product Info</th>
                                    <th scope="col"></th>
                                    <th scope="col">Price</th>
                                    <th scope="col">Qty</th>
                                    <th scope="col">Subtotal</th>

                                </tr>
                            </thead>

                            {% for appointment in appointment_service %}
                            <tr>
                                <td class="p-3 w-25">
                                    <img class="img-fluid rounded" src="{{ item.product.image.url }}">
                                </td>
                                <td class="py-3">
                                    <p class="my-0"><strong>{{ appointment.name }}</strong></p>
                                    <p class="my-0"><strong>Name: </strong>{ % userProfile % }{{ appointment.name|upper
                                        }}{ % else % }N/A{ % endif % }</p>
                                    <p class="my-0 small text-muted">Service: {{ appointment.service|upper }}</p>
                                </td>
                                <td class="py-3">
                                    <p class="my-0">${{ appointment.contact }}</p>
                                </td>
                                <td class="py-3 w-25">
                                    <form class="form update-form" method="POST"
                                        action="{% url 'appointment' appointment.user_id %}">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <div class="input-group">
                                                <div class="input-group-prepend">
                                                    <button class="decrement-qty btn btn-sm btn-black rounded-0"
                                                        data-item_id="{{ appointment.service_id }}"
                                                        id="decrement-qty_{{ appointment.service_id }}">
                                                        <span>
                                                            <i class="fas fa-minus fa-sm"></i>
                                                        </span>
                                                    </button>
                                                </div>
                                                <input class="form-control form-control-sm qty_input" type="number"
                                                    name="quantity" value="{{ appointment.service }}" min="1" max="99"
                                                    data-item_id="{{ appointment.service_id }}"
                                                    id="id_qty_{{ appointment.service_id }}">
                                                <div class="input-group-append">
                                                    <button class="increment-qty btn btn-sm btn-black rounded-0"
                                                        data-item_id="{{ appointment.service_id }}"
                                                        id="increment-qty_{{ appointment.service_id }}">
                                                        <span>
                                                            <i class="fas fa-plus fa-sm"></i>
                                                        </span>
                                                    </button>
                                                </div>
                                                { % if appointment.service.has_time % }
                                                <input type="hidden" name="appointment_time"
                                                    value="{{ appointment_time }}">
                                                {% endif % }
                                            </div>
                                        </div>
                                    </form>
                                    <a class="update-link text-info"><small>Update</small></a>
                                    <a class="remove-item text-danger float-right"
                                        id="remove_{{ appointment.service_id }}"
                                        data-product_size="{{appointment_time }}"><small>Remove</small></a>
                                </td>
                                <td class="py-3">
                                    <p class="my-0">$ {{ appointment.service_id | calc_subtotal:service_price }}</p>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td colspan="5" class="pt-5 text-right">
                                    <h6><strong>Appointment Total: ${{ total|floatformat:2 }}</strong></h6>
                                    <h6>Service: ${{ service|floatformat:2 }}</h6>
                                    <h4 class="mt-4"><strong>Grand Total: ${{ grand_total|floatformat:2 }}</strong></h4>
                                    {% if free_delivery_delta > 0 %}
                                    <p class="mb-1 text-danger">
                                        You could get free delivery by spending just <strong>${{ free_delivery_delta
                                            }}</strong>
                                        more!
                                    </p>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5" class="text-right">
                                    <a href="{% url 'appointment' %}" class="btn btn-outline-black rounded-0 btn-lg">
                                        <span class="icon">
                                            <i class="fas fa-chevron-left"></i>
                                        </span>
                                        <span class="text-uppercase">Keep Shopping</span>
                                    </a>
                                    <a href="{% url 'checkout' %}" class="btn btn-black rounded-0 btn-lg">
                                        <span class="text-uppercase">Secure Checkout</span>
                                        <span class="icon">
                                            <i class="fas fa-lock"></i>
                                        </span>
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    {% else %}
                    <p class="lead mb-5">No services.</p>
                    <a href="{% url 'appointment' %}" class="btn btn-outline-black rounded-0 btn-lg">
                        <span class="icon">
                            <i class="fas fa-chevron-left"></i>
                        </span>
                        <span class="text-uppercase">Book appointment</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endblock %}

        {% block postloadjs %}
        {{ block.super }}
        {% include 'Appointment/includes/services_input_script.html' %}

        <br><br><br><br><br><br>
        <script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!--<script src="//cdn.bootcss.com/moment.js/2.17.1/moment.min.js"></script>-->
        <!--<script src="//cdn.bootcss.com/bootstrap-datetimepicker/4.17.44/js/bootstrap-datetimepicker.min.js"></script>-->
        <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>-->
        <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>-->
        <script>
            var typeaheadData = {{ services| safe }};

            jQuery( document ).ready( function () {
                $( '#service' ).typeahead( {
                    source: typeaheadData
                } );
            } );
            function validate1( val ) {
                return true;
            }

            function validate2( val ) {

                return true;
            }

            $( document ).ready( function () {

                var current_fs, next_fs, previous_fs;

                $( ".next" ).click( function () {

                    str1 = "next0";
                    str2 = "next1";
                    str3 = "next2";
                    str4 = "next3";

                    if ( !str2.localeCompare( $( this ).attr( 'id' ) ) && validate1( 0 ) == true ) {
                        val2 = true;
                    }
                    else {
                        val2 = false;
                    }

                    if ( !str3.localeCompare( $( this ).attr( 'id' ) ) && validate2( 0 ) == true ) {
                        val3 = true;
                    }
                    else {
                        val3 = false;
                    }

                    if ( !str1.localeCompare( $( this ).attr( 'id' ) ) || ( !str2.localeCompare( $( this ).attr( 'id' ) ) && val2 == true ) || ( !str3.localeCompare( $( this ).attr( 'id' ) ) && val3 == true ) ) {
                        current_fs = $( this ).parent().parent();
                        next_fs = $( this ).parent().parent().next();

                        $( current_fs ).removeClass( "show" );
                        $( next_fs ).addClass( "show" );

                        $( "#progressbar li" ).eq( $( "fieldset" ).index( next_fs ) ).addClass( "active" );

                        current_fs.animate( {}, {
                            step: function () {

                                current_fs.css( {
                                    'display': 'none',
                                    'position': 'relative'
                                } );

                                next_fs.css( {
                                    'display': 'block'
                                } );
                            }
                        } );
                    }
                } );

                $( ".prev" ).click( function () {

                    current_fs = $( this ).parent().parent();
                    previous_fs = $( this ).parent().parent().prev();

                    $( current_fs ).removeClass( "show" );
                    $( previous_fs ).addClass( "show" );

                    $( "#progressbar li" ).eq( $( "fieldset" ).index( next_fs ) ).removeClass( "active" );

                    current_fs.animate( {}, {
                        step: function () {

                            current_fs.css( {
                                'display': 'none',
                                'position': 'relative'
                            } );

                            previous_fs.css( {
                                'display': 'block'
                            } );
                        }
                    } );
                } );

                $( '.radio-group .radio' ).click( function () {
                    $( this ).toggleClass( 'selected' );
                } );

            } );

            // Update quantity on click
            $( '.update-link' ).click( function ( e ) {
                var form = $( this ).prev( '.update-form' );
                form.submit();
            } )

            // Remove item and reload on click
            $( '.remove-appointment' ).click( function ( e ) {
                var csrfToken = "{{ csrf_token }}";
                var itemId = $( this ).attr( 'id' ).split( 'remove_' )[ 1 ];
                var size = $( this ).data( 'product_size' );
                var url = `/appointment/remove/${ itemId }/`;
                var data = { 'csrfmiddlewaretoken': csrfToken, 'appointment': service };

                $.post( url, data )
                    .done( function () {
                        location.reload();
                    } );
            } )
        </script>


        </script>
        {% endblock %}
        {% endblock %}